<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kali Web Terminal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css" />
    <style>
        body { 
            margin: 0; 
            background: #000; 
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        /* Toolbar for Mobile Actions */
        #toolbar {
            height: 50px;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: space-around;
            border-bottom: 1px solid #333;
            padding: 0 10px;
        }

        button {
            background: #333;
            color: #fff;
            border: 1px solid #555;
            padding: 8px 15px;
            border-radius: 5px;
            font-size: 14px;
            cursor: pointer;
            font-weight: bold;
        }
        button:active { background: #555; }

        #terminal { 
            flex-grow: 1; 
            width: 100%; 
        }
    </style>
</head>
<body>
    <div id="toolbar">
        <button onclick="changeFontSize(-1)">A-</button>
        <button onclick="changeFontSize(1)">A+</button>
        <button onclick="copyAll()">ðŸ“‹ Copy All</button>
        <button onclick="fitTerminal()">âŸ² Fit</button>
    </div>

    <div id="terminal"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links/lib/xterm-addon-web-links.js"></script>

    <script>
        const socket = io();
        let currentFontSize = 14; // Default size

        const term = new Terminal({
            cursorBlink: true,
            fontSize: currentFontSize,
            fontFamily: '"Fira Code", "Courier New", monospace',
            theme: {
                background: '#000000',
                foreground: '#00ff00',
            },
            // Allow selecting text with mouse/touch
            rightClickSelectsWord: true,
            screenReaderMode: true, // Helps with mobile selection
        });

        const fitAddon = new FitAddon.FitAddon();
        term.loadAddon(fitAddon);
        term.loadAddon(new window.WebLinksAddon.WebLinksAddon());
        
        term.open(document.getElementById('terminal'));
        fitAddon.fit();

        // --- Logic for Zoom ---
        function changeFontSize(amount) {
            currentFontSize += amount;
            if (currentFontSize < 8) currentFontSize = 8;
            if (currentFontSize > 30) currentFontSize = 30;
            term.options.fontSize = currentFontSize;
            fitAddon.fit();
        }

        // --- Logic for Copy All ---
        function copyAll() {
            term.selectAll();
            const text = term.getSelection();
            navigator.clipboard.writeText(text).then(() => {
                alert("Text Copied to Clipboard!");
                term.clearSelection();
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert("Copy failed. Please manually select and copy.");
            });
        }
        
        function fitTerminal() {
            fitAddon.fit();
            socket.emit('resize', { cols: term.cols, rows: term.rows });
        }

        // --- Socket Logic ---
        term.onData(data => socket.emit('input', data));
        socket.on('output', data => term.write(data));

        window.addEventListener('resize', () => {
            fitAddon.fit();
            socket.emit('resize', { cols: term.cols, rows: term.rows });
        });
    </script>
</body>
</html>
