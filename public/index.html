<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kali Web Terminal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm/css/xterm.css" />
    <style>
        body { 
            margin: 0; 
            background: #000; 
            height: 100vh;
            overflow: hidden;
            touch-action: none; 
        }
        
        #terminal { 
            width: 100%; 
            height: 100%; 
        }

        /* SMALLER Floating Buttons */
        .float-btn {
            position: fixed;
            bottom: 20px;       /* تھوڑا نیچے کیا ہے */
            width: 30px;        /* پہلے 60px تھا، اب 30px (آدھا) */
            height: 30px;       /* پہلے 60px تھا، اب 30px (آدھا) */
            background: rgba(255, 255, 255, 0.15); 
            color: #00ff00;
            border: 1px solid #00ff00; /* بارڈر بھی باریک کیا ہے */
            border-radius: 50%;
            font-size: 16px;    /* فونٹ بھی چھوٹا کیا ہے */
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1000;
            user-select: none;
            backdrop-filter: blur(2px);
        }

        .float-btn:active {
            background: rgba(0, 255, 0, 0.4);
        }

        /* Positions */
        #btn-minus { left: 15px; }
        #btn-plus { right: 15px; }

        /* Toast Notification */
        #toast {
            visibility: hidden;
            min-width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 2px;
            padding: 10px;
            position: fixed;
            z-index: 1;
            left: 50%;
            bottom: 50%;
            transform: translate(-50%, 50%);
            font-size: 14px;
            border: 1px solid #00ff00;
        }

        #toast.show {
            visibility: visible;
            -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
            animation: fadein 0.5s, fadeout 0.5s 2.5s;
        }

        @-webkit-keyframes fadein { from {bottom: 40%; opacity: 0;} to {bottom: 50%; opacity: 1;} }
        @keyframes fadein { from {bottom: 40%; opacity: 0;} to {bottom: 50%; opacity: 1;} }
        @-webkit-keyframes fadeout { from {bottom: 50%; opacity: 1;} to {bottom: 40%; opacity: 0;} }
        @keyframes fadeout { from {bottom: 50%; opacity: 1;} to {bottom: 40%; opacity: 0;} }
    </style>
</head>
<body>

    <div id="btn-minus" class="float-btn" onclick="changeFontSize(-2)">−</div>

    <div id="btn-plus" class="float-btn" onclick="changeFontSize(2)">+</div>

    <div id="terminal"></div>

    <div id="toast">✅ Text Copied!</div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm/lib/xterm.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit/lib/xterm-addon-fit.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-web-links/lib/xterm-addon-web-links.js"></script>

    <script>
        const socket = io();
        let currentFontSize = 14;

        const term = new Terminal({
            cursorBlink: true,
            fontSize: currentFontSize,
            fontFamily: '"Fira Code", monospace',
            theme: { background: '#000000', foreground: '#00ff00' },
            allowTransparency: true
        });

        const fitAddon = new FitAddon.FitAddon();
        term.loadAddon(fitAddon);
        term.open(document.getElementById('terminal'));
        fitAddon.fit();

        // Zoom Logic
        function changeFontSize(amount) {
            currentFontSize += amount;
            if (currentFontSize < 6) currentFontSize = 6;
            if (currentFontSize > 40) currentFontSize = 40;
            term.options.fontSize = currentFontSize;
            fitAddon.fit();
            socket.emit('resize', { cols: term.cols, rows: term.rows });
        }

        // Long Press Copy Logic
        let pressTimer;
        const terminalDiv = document.getElementById('terminal');

        terminalDiv.addEventListener('touchstart', (e) => {
            if (e.touches.length === 1) {
                pressTimer = setTimeout(() => {
                    copyAll();
                }, 800);
            }
        });

        terminalDiv.addEventListener('touchend', () => clearTimeout(pressTimer));
        terminalDiv.addEventListener('touchmove', () => clearTimeout(pressTimer));

        function copyAll() {
            term.selectAll();
            const text = term.getSelection();
            navigator.clipboard.writeText(text).then(() => {
                showToast();
                term.clearSelection();
            }).catch(err => console.error('Copy failed', err));
        }

        function showToast() {
            var x = document.getElementById("toast");
            x.className = "show";
            setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
        }

        // Socket Logic
        term.onData(data => socket.emit('input', data));
        socket.on('output', data => term.write(data));

        window.addEventListener('resize', () => {
            fitAddon.fit();
            socket.emit('resize', { cols: term.cols, rows: term.rows });
        });
    </script>
</body>
</html>
